<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>SVG</title>
    <link rel="shortcut icon" href="images/dau.png">
    <script src="https://d3js.org/d3.v3.js"></script>

</head>
<body>
<p>Bar chart</p>
<div id="option">
    <input name="updateButton"
           type="button"
           value="Update"
            onclick="updateData()"
    />
</div>
<script>
    var width = 600,
        height = 250
    ;
    var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
        11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];

    var xScale = d3.scale.ordinal()
        .domain(d3.range(dataset.length))       // = domain([0,1,2,3])
        .rangeRoundBands([0, width], 0.05);     // round 5 percent for padding

    // This means:
    // (w - 0) / xScale.domain().length
    // (600 - 0) / 20
    // 600 / 20
    // 30

    // 30 is the max width (i.e. without padding) of a bar
    // 5 percent of 30 = 1.5 -- round --> = 2
    // => xScale.rangeBand() = 30 - 2 = 28

    // This function take i, and return the position for x
    // Also, it gives width of each bar: xScale.rangeBand()


    var yScale = d3.scale.linear()
        .domain([0, d3.max(dataset)])
        .range([height, 0]);

    var svg = d3.select("body").append("svg")
        .attr({
            width: width,
            height: height
        });

    svg.selectAll("rect")
        .data(dataset)
        .enter()
        .append("rect")
        .attr({
            x: (d,i) => xScale(i),
            y: d => yScale(d),
            width: xScale.rangeBand(),
            height: d => height - yScale(d),
            "fill": d => "rgb(0,0," + Math.round(d*10) + ")"
        });

    svg.selectAll("text")
        .data(dataset)
        .enter()
        .append("text")
        .text(d => d)
        .attr({
            "text-anchor": "middle",
            x: (d,i) => xScale(i) + xScale.rangeBand() /2,
            y: d => yScale(d) + 14,
            "fill": "white",
            "font-size": "11px",
            "font-family": "sans-serif"
        });

    function updateData(){
        dataset = [];
        var maxValue = 100;
        for (var i = 0; i < 20; i++){
            dataset.push(Math.round(Math.random() * maxValue))
        }

        yScale.domain([0, d3.max(dataset)]);

        // Adjust visual for new data:
        svg.selectAll("rect").data(dataset)
            .transition()
            //.delay((d,i) => i/dataset.length * 1000)
            .duration(1000)
            .attr({
                y: d => yScale(d),
                height: d => height - yScale(d),
                "fill": d => "rgb(0,0," + Math.round(d/d3.max(dataset)*255) + ")"
            });

        svg.selectAll("text").data(dataset)
            .transition()
            //.delay((d,i) => i/dataset.length * 1000)
            .duration(1000)
            .text(d => d)
            .attr({
                y: d => yScale(d) + 14
            })

    }



</script>
</body>
</html>